<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE article
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
  <!ENTITY productnamex "<phrase xmlns='http://docbook.org/ns/docbook' os='sles;sled;osuse'>&productname;</phrase><phrase xmlns='http://docbook.org/ns/docbook' os='article'>&sls;</phrase>">
  <!ENTITY productnumberx "<phrase xmlns='http://docbook.org/ns/docbook' os='sles;sled;osuse'>&productnumber;</phrase><phrase xmlns='http://docbook.org/ns/docbook' os='article'>code stream 15</phrase>">
]>
<article xml:id="article-suseconnect-tracking"
         xmlns="http://docbook.org/ns/docbook"
         version="5.0"
         xml:lang="en"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Tracking active systems with &suseconnect;</title>
 <titleabbrev>Tracking active systems with &suseconnect;</titleabbrev>
 <info><productname>&productnamex;</productname>
  <productnumber>&productnumberx;</productnumber><date>
<?dbtimestamp format="B d, Y" ?></date>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker>
    <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
    <dm:component>Security</dm:component>
    <dm:product>Documentation</dm:product>
    <dm:assignee>tbazant@suse.com</dm:assignee>
   </dm:bugtracker>
   <dm:editurl>https://github.com/SUSE/doc-unversioned/blob/main/xml/</dm:editurl>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    This document introduces basic information about &suseconnect; and how
    &scc; and registration servers use it to gather information about active
    systems and their hardware environment.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="suseconnect-introduction">
  <title>Introduction</title>

  <sect2 xml:id="suseconnect-whatis">
   <title>What is &suseconnect;?</title>
   <para>
    &suseconnect; is a tool to register SLE-based operating systems with &scc;
    or other registration serve, such as &suma;, &rmt;, or &smt;. Registered
    systems receive updates to installed packages, for example, to increase
    security of the operating system. With &suseconnect;, you can additionally
    register extensions and modules that extend the base system's
    functionality.
   </para>
  </sect2>

  <sect2 xml:id="suseconnect-general">
   <title>Existing information</title>
   <para>
    This document does not cover general usage of &suseconnect;. To find more
    basic information about how to register your system, modules, and
    extensions with &suseconnect;, refer to
    <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-register-sle.html"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="suseconnect-tracking-active-hosts">
  <title>Tracking active systems</title>

  <para>
   With newer versions of &suseconnect;, each registered host contacts &scc; or
   registration server automatically on a daily basis. It sends unique
   identification of the host and description of its hardware environment.
  </para>

  <sect2 xml:id="suseconnect-customer-benefit">
   <title>Customer benefit</title>
   <para>
    The new functionality of &suseconnect; bring the following benefits to the
    customer:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Ability to identify <emphasis role="bold">all types of
      deployments</emphasis> of systems, no matter if they are derived from a
      custom image or clones of an already registered virtual machine.
     </para>
    </listitem>
    <listitem>
     <para>
      By contacting the registration server regularly, you can obtain the
      number of <emphasis role="bold">actually running</emphasis> registered
      systems. This gives better insight into the consumption of SUSE
      subscriptions.
     </para>
    </listitem>
    <listitem>
     <para>
      Updates to registration tools provide clearer picture of your workloads.
      You can filter out systems that are no longer running or decommissioned.
     </para>
    </listitem>
    <listitem>
     <para>
      By collecting regular registration and hardware information, we will
      continue to improve our products to reflect your needs and let you manage
      system subscriptions more easily.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="suseconnect-tracking-prerequisites-">
   <title>Prerequisites</title>
   <para>
    In order to use the extended &suseconnect; functionality, you need to:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Run a supported and registered SLE-based host with all update patches
      applied.
     </para>
    </listitem>
    <listitem>
     <para>
      Verify that the host system includes the <command>&suseconnect;</command>
      command version 0.3.33 or higher.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="suseconnect-tracking-how-it-works">
   <title>How it works</title>
   <para>
    We extended &suseconnect; with the new option
    <option>--keep-alive</option>. The command <command>&suseconnect;
    --keep-alive</command> updates the last time that a host contacted its
    registration server and attaches the host's hardware information.
   </para>
   <para>
    The &suseconnect; package ships with two &systemd; units:
   </para>
   <variablelist>
    <varlistentry>
     <term><filename>suseconnect-keepalive.service</filename></term>
     <listitem>
      <para>
       A service which runs the command <command>&suseconnect;
       --keep-alive</command> on demand.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>suseconnect-keepalive.timer</filename></term>
     <listitem>
      <para>
       A timer which runs the service
       <filename>suseconnect-keepalive.service</filename> once a day.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    These units are responsible for keeping the system information up-to-date
    with the &scc; or a registration server, and to provide accurate data about
    subscription usage.
   </para>
   <note>
    <title>The timer is enabled automatically</title>
    <para>
     When the &suseconnect; package is installed or updated, and its version is
     equal to or greater than the one described above, the keep-alive timer
     will be enabled automatically.
    </para>
   </note>
   <sect3 xml:id="disabling-suseconnect-timer">
    <title>Disabling the keep-alive timer</title>
    <para>
     If you prefer to not have the &suseconnect; keep-alive timer running on
     your system, you can disable it with <command>systemctl</command>:
    </para>
<screen>&prompt.sudo;systemctl disable --now suse-connect-keepalive.timer</screen>
    <para>
     Once the timer is disabled, subsequent updates to the &suseconnect;
     package will not reenable it.
    </para>
    <tip>
     <title>Re-enabling the keep-alive timer</title>
     <para>
      If you decide to re-enable the disabled keep-alive timer, run the
      following command:
     </para>
<screen>&prompt.sudo;systemctl enable --now suse-connect-keepalive.timer</screen>
    </tip>
   </sect3>
  </sect2>

  <sect2 xml:id="identifying-inactive-systems-with-registration-servers">
   <title>Identifying inactive systems</title>
   <para>
    When &suseconnect; daily reports details about active hosts, &scc; or
    registration servers collect this information and let you filter out
    registered inactive hosts. If your hosts are registered against &rmt; or
    &suma;, these registration servers forward the received information to
    &scc;.
   </para>
   <sect3 xml:id="identifying-inactive-systems-with-scc">
    <title>Identifying inactive systems with &scc;</title>
    <para>
     In &scc; Web user interface, you can limit the list of subscriptions to
     see only inactive hosts.
    </para>
    <procedure>
     <step>
      <para>
       Log in to &scc; at <link xlink:href="https://scc.suse.com"/> and select
       your organization in the left pane.
      </para>
     </step>
     <step>
      <para>
       Select <guimenu>Systems</guimenu> from the top menu to list all
       registered hosts by default.
      </para>
     </step>
     <step>
      <para>
       Select <guimenu>Inactive</guimenu> from the top left drop-down list.
      </para>
      <figure>
       <title>Drop-down list with a filter for inactive hosts</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="scc-inactive-filter.png" width="75%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="scc-inactive-filter.png" width="75%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
     <step>
      <para>
       If you have sufficient privileges and your inactive host is registered
       directly with &scc;, you can de-register it by clicking the three dots
       on its right and selecting <guimenu>De-register</guimenu>.
      </para>
     </step>
    </procedure>
   </sect3>
   <sect3 xml:id="identifying-inactive-systems-with-rmt">
    <title>Identifying inactive systems with &rmt;</title>
    <para>
     By using the <command>rmt-cli purge</command> command, you can view hosts
     that have not contacted the &rmt; server since a given date in the past:
    </para>
<screen>
&prompt.root;rmt-cli systems purge --before 2021-06-16
+--------------------------------------+--------------+-------------------------+-------------------------+--------------------------------------------+
| Login                                | Hostname     | Registration time       | Last seen               | Products                                   |
+--------------------------------------+--------------+-------------------------+-------------------------+--------------------------------------------+
| SCC_c5b07772abbd43b497cd3e568eede75a | 6e485e48b2b0 | 2021-06-11 13:38:07 UTC | 2021-06-11 13:52:01 UTC | SLES/15.2/x86_64                           |
|                                      |              |                         |                         | sle-module-basesystem/15.2/x86_64          |
|                                      |              |                         |                         | sle-module-server-applications/15.2/x86_64 |
| SCC_5fcf292b92e049269eef726e93a90f5a | node52       | 2021-06-15 13:29:24 UTC | 2021-06-15 13:31:25 UTC | SLES/15.2/x86_64                           |
|                                      |              |                         |                         | sle-module-basesystem/15.2/x86_64          |
|                                      |              |                         |                         | sle-module-server-applications/15.2/x86_64 |
+--------------------------------------+--------------+-------------------------+-------------------------+--------------------------------------------+
Do you want to delete these systems? (y/n) y
Purged systems that have not contacted this RMT since 2021-06-16.
</screen>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="system-data-gathered-by-scc">
  <title>System data gathered by &scc;</title>

  <para>
   When a system is registered directly via &scc;, or its registration
   information is forwarded by &rmt; or &suma;, &scc; collects the following
   information:
  </para>

  <table>
   <title>System attributes collected by &scc;</title>
   <tgroup cols='3' align='left'>
    <thead>
     <row>
      <entry>
       System Attribute
      </entry>
      <entry>
       Type
      </entry>
      <entry>
       Example value
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
        Hostname
      </entry>
      <entry>
        string
      </entry>
      <entry>
       virtual.domain.net
      </entry>
     </row>
     <row>
      <entry>
        CPUs
      </entry>
      <entry>
       int
      </entry>
      <entry>
       1
      </entry>
     </row>
     <row>
      <entry>
       Sockets
      </entry>
      <entry>
       int
      </entry>
      <entry>
       2
      </entry>
     </row>
     <row>
      <entry>
       Architecture
      </entry>
      <entry>
       string
      </entry>
      <entry>
       x86_64
      </entry>
     </row>
     <row>
      <entry>
       UUID
      </entry>
      <entry>
       uuid
      </entry>
      <entry>
       6A5072A0-311B-430E-8EDE-A8770788B92D
      </entry>
     </row>
     <row>
      <entry>
       Hypervisor
      </entry>
      <entry>
       string
      </entry>
      <entry>
       KVM
      </entry>
     </row>
     <row>
      <entry>
       Cloud Provider
      </entry>
      <entry>
       string
      </entry>
      <entry>
       Amazon (can also be 'Google' or 'Azure', not 100% accurate in the 'Azure' case)
      </entry>
     </row>
     <row>
      <entry>
       Last Seen Date
      </entry>
      <entry>
       date
      </entry>
      <entry>
       2021-05-05 (the last time that the system contacted &scc;)
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
 </sect1>
</article>
